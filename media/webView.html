<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'none';
                 img-src {{cspSource}} https:;
                 script-src 'nonce-{{nonce}}';
                 style-src {{cspSource}} 'unsafe-inline';">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Locust Menu</title>
  <style>
    /* Locust theme */
    :root{
      --bg:#111315; --panel:#1a1d1f; --panel-border:#2a2f34;
      --text:#e6e6e6; --muted:#9aa0a6; --accent:#28a745; --accent-hover:#23913d;
    }
    body{font-family:var(--vscode-font-family); background:var(--bg); color:var(--text); margin:0; padding:14px 16px;
         background:linear-gradient(0deg,rgba(0,0,0,.0),rgba(0,0,0,.0)),var(--panel);
         border:1px solid var(--panel-border); border-radius:8px; box-shadow:0 2px 12px rgba(0,0,0,.35);}
    h1{margin:0 0 8px; font-size:16px; font-weight:600; letter-spacing:.2px;}
    h2{margin:16px 0 6px; font-size:15px; font-weight:600;}
    p{margin:6px 0 12px; color:var(--muted);}
    .row{display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 12px;}
    .row.actions{gap:8px;}
    button{padding:8px 14px; border:1px solid #1f7a36; border-radius:6px; background:var(--accent); color:#fff;
           cursor:pointer; font-weight:600; letter-spacing:.1px; transition:background 120ms,box-shadow 120ms,transform 60ms;}
    button:hover,button:focus-visible{background:var(--accent-hover); outline:none; box-shadow:0 0 0 2px rgba(40,167,69,.25);}
    button:active{transform:translateY(1px);}
    button[disabled]{opacity:.7; cursor:default; filter:grayscale(.1);}
    button.danger{background:var(--vscode-inputValidation-errorBackground); color:var(--vscode-editor-foreground); border-color:transparent;}
    a{color:var(--accent); text-decoration:none; font-weight:500;}
    a:hover,a:focus-visible{color:var(--accent-hover); text-decoration:underline; outline:none;}
  </style>
</head>
<body
  data-cloud="{{isCloud}}"
  data-cloud-started="{{cloudStarted}}"
  data-local-started="{{localStarted}}">
  <h1>Locust {{titleSuffix}}</h1>
  <p>{{subtitle}}</p>

  {{controls}}

  <br>
  <h2>Get Help</h2>
  <p>
    <a href="#" id="linkGuide">Beginner Guide</a><br>
    <a href="https://docs.locust.io/en/stable/" target="_blank">Locust Docs</a><br>
    {{supportBlock}}
  </p>

  <script nonce="{{nonce}}">
    (function () {
      const vscode = acquireVsCodeApi();
      const run = (cmd) => vscode.postMessage({ type: 'run', command: cmd });

      const setLocalVisual = (running) => {
        const b = document.getElementById('btnRunLocal');
        if (!b) return;
        b.textContent = running ? 'Running…' : 'Local Test';
        b.toggleAttribute('disabled', running);
      };
      const setCloudVisual = (running) => {
        const id = document.getElementById('btnLocustCloud') ? 'btnLocustCloud' : 'btnRunUI';
        const b = document.getElementById(id);
        if (!b) return;
        b.textContent = running ? 'Running…' : 'Cloud Test';
        b.toggleAttribute('disabled', running);
      };

      const isCloud = document.body.getAttribute('data-cloud') === '1';
      const localStarted = document.body.getAttribute('data-local-started') === '1';
      const cloudStarted = document.body.getAttribute('data-cloud-started') === '1';

      // initial paint
      setLocalVisual(localStarted);
      setCloudVisual(cloudStarted);

      if (isCloud) {
        const btnRunCloud = document.getElementById('btnRunUI');
        btnRunCloud?.addEventListener('click', () => {
          if (cloudStarted) return;
          run('locust.toggleCloudSimple');
          setCloudVisual(true);
        });
      } else {
        const btnLocal = document.getElementById('btnRunLocal');
        const btnCloud = document.getElementById('btnLocustCloud');
        const btnHar   = document.getElementById('btnConvertHar');

        btnLocal?.addEventListener('click', () => {
          if (localStarted) return;
          run('locust.toggleLocalSimple');
          setLocalVisual(true);
        });

        btnCloud?.addEventListener('click', () => {
          if (cloudStarted) return;
          run('locust.toggleCloudSimple');
          setCloudVisual(true);
        });

        btnHar?.addEventListener('click', () => run('locust.convertHar'));
      }

      document.getElementById('btnStopAll')?.addEventListener('click', () => {
        run('locust.stopLocalThenCloudIfAny');
        setLocalVisual(false);
        setCloudVisual(false);
      });

      document.getElementById('linkGuide')?.addEventListener('click', (e) => {
        e.preventDefault();
        run('locust.startBeginnerTour');
      });

      window.addEventListener('message', (ev) => {
        const msg = ev.data || {};
        if (msg.type === 'state') {
          if (typeof msg.cloudStarted === 'boolean') setCloudVisual(msg.cloudStarted);
          if (typeof msg.localStarted === 'boolean') setLocalVisual(msg.localStarted);
        }
      });
    })();
  </script>
</body>
</html>
